# =============================================================================
# Study Mode API Environment Variables
# =============================================================================
# Copy this file to .env and fill in the values for local development.

# -----------------------------------------------------------------------------
# OpenAI Configuration (required)
# -----------------------------------------------------------------------------
OPENAI_API_KEY=sk-your-openai-api-key

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
PORT=8000

# -----------------------------------------------------------------------------
# Redis Configuration (required for caching + rate limiting)
# -----------------------------------------------------------------------------
# Recommended: Upstash Redis (serverless) - https://console.upstash.com
#
# IMPORTANT for Upstash:
#   1. Use 'rediss://' (with double-s) for SSL connection
#   2. REDIS_PASSWORD is ONLY the token value (no UPSTASH_REDIS_REST_TOKEN= prefix!)
#   3. Get these from: Upstash Console > Your Database > Details tab
#
# Example Upstash format:
#   REDIS_URL=rediss://default@your-endpoint.upstash.io:6379
#   REDIS_PASSWORD=AXxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
#
# Wrong (common mistake):
#   REDIS_PASSWORD=UPSTASH_REDIS_REST_TOKEN=AXxx...  # Don't include the variable name!
#
REDIS_URL=rediss://default@your-redis-host:6379
REDIS_PASSWORD=your-redis-password-token
# REDIS_MAX_CONNECTIONS=100  # Default: 10

# -----------------------------------------------------------------------------
# GitHub Content Loading
# -----------------------------------------------------------------------------
# GitHub token for fetching lesson content (5000 req/hr with token vs 60 without)
GITHUB_TOKEN=ghp_your-github-token
GITHUB_REPO=panaversity/agentfactory

# Content cache TTL in seconds (default: 24 hours)
CONTENT_CACHE_TTL=86400

# -----------------------------------------------------------------------------
# Security & CORS
# -----------------------------------------------------------------------------
# Comma-separated list of allowed origins (no wildcards in production!)
ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com

# SSO server URL for JWT/JWKS verification
SSO_URL=https://your-sso-provider.com

# -----------------------------------------------------------------------------
# Admin API Authentication
# -----------------------------------------------------------------------------
# Secret for authenticating admin endpoints (e.g., /admin/invalidate-cache)
# IMPORTANT: This must match the ADMIN_SECRET in your GitHub Actions secrets
# for the cache invalidation workflow to work.
# Generate with: openssl rand -hex 32
ADMIN_SECRET=your-admin-secret-here

# -----------------------------------------------------------------------------
# Development Mode
# -----------------------------------------------------------------------------
# When true, bypasses authentication (for local development only!)
DEV_MODE=false

# Dev mode user settings (used when DEV_MODE=true)
DEV_USER_ID=dev-user-123
DEV_USER_EMAIL=dev@example.com
DEV_USER_NAME=Developer

# -----------------------------------------------------------------------------
# PostgreSQL Database (required for chat persistence)
# -----------------------------------------------------------------------------
# Format: postgresql://user:password@host/database?sslmode=require
# The API auto-converts to asyncpg driver format internally
# Recommended: Neon, Supabase, or any PostgreSQL provider
STUDY_MODE_CHATKIT_DATABASE_URL=postgresql://user:password@host/database?sslmode=require

# Connection pool settings (optional, defaults shown)
# STUDY_MODE_CHATKIT_POOL_SIZE=20
# STUDY_MODE_CHATKIT_MAX_OVERFLOW=10
# STUDY_MODE_CHATKIT_POOL_TIMEOUT=30
# STUDY_MODE_CHATKIT_POOL_RECYCLE=3600
# STUDY_MODE_CHATKIT_STATEMENT_TIMEOUT=30000
# STUDY_MODE_CHATKIT_SCHEMA_NAME=study_mode_chat

# -----------------------------------------------------------------------------
# Token Metering API Integration (optional)
# -----------------------------------------------------------------------------
# Enable freemium token tracking (requires token-metering-api running)
METERING_ENABLED=false
METERING_API_URL=http://localhost:8001
METERING_DEFAULT_ESTIMATE=5000  # Default token estimate for reservations
